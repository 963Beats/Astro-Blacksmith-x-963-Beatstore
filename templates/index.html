<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>963 | Beat Store</title>

<script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
[x-cloak] { display:none!important }
</style>
</head>

<body class="bg-[#0b0e17] text-slate-100"
x-data="playerData()"
x-init="init()">

<!-- MOBILE GENRE DRAWER -->
<div x-show="mobileMenuOpen" x-cloak class="fixed inset-0 z-50 bg-black/80 md:hidden">
  <div class="absolute left-0 top-0 bottom-0 w-72 bg-[#0f1322] p-6 overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
      <h2 class="font-black text-emerald-400">Genres</h2>
      <button @click="mobileMenuOpen=false">âœ•</button>
    </div>

    <template x-for="g in genres" :key="g.folder">
      <button
        @click="selectGenre(g); mobileMenuOpen=false"
        class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold text-slate-300 hover:bg-white/5">
        <span x-text="g.name"></span>
      </button>
    </template>
  </div>
</div>

<div class="flex h-screen overflow-hidden">

<!-- DESKTOP SIDEBAR -->
<aside class="hidden md:flex w-72 bg-[#0f1322] border-r border-slate-800 flex-col">
  <div class="p-8">
    <h1 class="text-xl font-black text-emerald-400">963</h1>
    <p class="text-[10px] text-slate-500 font-bold tracking-widest">PREMIUM BEATS</p>
  </div>

  <nav class="flex-1 px-4 space-y-1 overflow-y-auto">
    <template x-for="g in genres" :key="g.folder">
      <button
        @click="selectGenre(g)"
        :class="activeGenre?.folder===g.folder
          ? 'bg-emerald-500/10 text-emerald-400 border-l-4 border-emerald-500'
          : 'text-slate-400 hover:bg-white/5'"
        class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold">
        <span x-text="g.name"></span>
      </button>
    </template>
  </nav>
</aside>

<!-- MAIN -->
<main class="flex-1 overflow-y-auto">

<!-- MOBILE HEADER -->
<div class="md:hidden p-6 flex justify-between items-center bg-[#0f1322] border-b border-slate-800 sticky top-0 z-40">
  <h1 class="font-black text-emerald-400">963</h1>
  <button @click="mobileMenuOpen=true">
    <i data-lucide="menu"></i>
  </button>
</div>

<!-- HEADER -->
<header class="p-8">
  <h1 class="text-4xl font-black" x-text="activeGenre?.name || 'Select Genre'"></h1>

  <p x-show="activeGenre?.beats?.some(b=>b.is_new)"
     x-cloak
     class="mt-2 text-xs font-black text-emerald-400 tracking-widest">
     NEW UPLOADS TODAY
  </p>
</header>

<!-- BEATS -->
<div class="px-6 pb-40 space-y-2">
<template x-for="beat in activeGenre?.beats || []" :key="beat.file">

<div
@click="playTrack(beat)"
:class="[
  beat.is_new ? 'ring-1 ring-emerald-400/30 bg-emerald-500/5' : '',
  currentTrack?.file===beat.file ? 'bg-white/5 border-l-4 border-emerald-500' : ''
]"
class="flex items-center gap-4 p-3 rounded-xl hover:bg-white/5 cursor-pointer">

<!-- IMAGE -->
<img
:src="`/visuals/${beat.genre_folder}/${beat.image}`"
class="w-12 h-12 rounded-lg object-cover"/>

<!-- INFO -->
<div class="flex-1">
  <div class="flex items-center gap-2">
    <span class="font-bold" x-text="beat.title"></span>
    <span x-show="beat.is_new" x-cloak
      class="text-[9px] px-2 py-0.5 rounded-full bg-emerald-400 text-black font-black">
      NEW
    </span>
  </div>
  <div class="text-[10px] text-slate-500 uppercase font-bold"
       x-text="activeGenre.name"></div>
</div>

<button
@click.stop="playTrack(beat)"
class="px-4 py-2 bg-emerald-500 text-black text-[10px] font-black rounded-full">
PLAY
</button>

</div>
</template>
</div>

<!-- PLAYER BAR -->
<div x-show="currentTrack"
x-cloak
class="fixed bottom-0 left-0 right-0 bg-[#0f1322]/95 border-t border-slate-800 p-4">

<div class="flex items-center gap-4">

<img
:src="`/visuals/${currentTrack.genre_folder}/${currentTrack.image}`"
class="w-12 h-12 rounded-lg object-cover"/>

<div class="flex-1">
  <div class="font-bold" x-text="currentTrack.title"></div>
  <div class="text-[10px] text-emerald-400 font-black uppercase"
       x-text="activeGenre?.name"></div>
</div>

<button @click="togglePlay()"
class="w-10 h-10 bg-white text-black rounded-full flex items-center justify-center">
<i :data-lucide="isPlaying?'pause':'play'"></i>
</button>

</div>
</div>

</main>
</div>

<script>
function playerData(){
return {
  genres: {{ genres | tojson }},
  activeGenre:null,
  currentTrack:null,
  audio:new Audio(),
  isPlaying:false,
  mobileMenuOpen:false,

  init(){
    this.activeGenre=this.genres[0]||null
    lucide.createIcons()
  },

  selectGenre(g){
    this.activeGenre=g
  },

  playTrack(beat){
    if(this.currentTrack?.file===beat.file){
      this.togglePlay()
      return
    }
    this.audio.src=`/audio/${beat.genre_folder}/${beat.file}`
    this.currentTrack=beat
    this.audio.play()
    this.isPlaying=true
    setTimeout(()=>lucide.createIcons(),50)
  },

  togglePlay(){
    this.isPlaying ? this.audio.pause() : this.audio.play()
    this.isPlaying=!this.isPlaying
    setTimeout(()=>lucide.createIcons(),50)
  }
}}
</script>

</body>
</html>
